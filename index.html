<!DOCTYPE html>
<html>
<head>
    <title>LST Viewer</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #010a13; color: #cdbe91; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
        .row { display: grid; grid-template-columns: 100px 60px 60px; gap: 20px; align-items: center; padding: 10px; border-bottom: 1px solid #785a28; }
        .spell { width: 50px; height: 50px; border: 2px solid #785a28; position: relative; }
        .spell img { width: 100%; height: 100%; }
        .cooldown { filter: grayscale(1) brightness(0.3); }
        .timer { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; color: white; text-shadow: 2px 2px #000; }
    </style>
</head>
<body>
    <h2 id="status">Łączenie...</h2>
    <div id="viewer"></div>

    <script>
        const peer = new Peer();
        const hostId = window.location.hash.substring(1);
        
        peer.on('open', () => {
            const conn = peer.connect(hostId);
            conn.on('open', () => { document.getElementById('status').innerText = "LIVE VIEW"; });
            conn.on('data', data => {
                if(data.type === 'INIT') render(data.config);
                if(data.type === 'TIMER') startTimer(data);
            });
        });

        function render(cfg) {
            document.getElementById('viewer').innerHTML = Object.keys(cfg).map(role => `
                <div class="row">
                    <div>${role}</div>
                    <div class="spell" id="${role}-0"><img src="${cfg[role][0]}"><div class="timer"></div></div>
                    <div class="spell" id="${role}-1"><img src="${cfg[role][1]}"><div class="timer"></div></div>
                </div>
            `).join('');
        }

        function startTimer({role, i, time}) {
            let timeLeft = time;
            const el = document.getElementById(`${role}-${i}`);
            el.classList.add('cooldown');
            const itv = setInterval(() => {
                timeLeft--;
                el.querySelector('.timer').innerText = timeLeft > 0 ? timeLeft : "";
                if(timeLeft <= 0) { clearInterval(itv); el.classList.remove('cooldown'); }
            }, 1000);
        }
    </script>
</body>
</html>