<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LST LIVE VIEW</title>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<style>
    body { background: #050a12; color: #cdbe91; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
    #status { position: fixed; top: 10px; font-size: 10px; color: #785a28; letter-spacing: 2px; text-transform: uppercase; }
    .grid { display: grid; gap: 12px; width: 340px; padding: 25px; border: 2px solid #d4af37; background: #0a0f19; }
    .row { display: grid; grid-template-columns: 85px 1fr 1fr; align-items: center; gap: 15px; border-bottom: 1px solid rgba(212,175,55,0.1); padding-bottom: 8px; }
    .role-name { font-weight: bold; font-size: 13px; color: #d4af37; }
    .spell { width: 50px; height: 50px; border: 1px solid #785a28; position: relative; background: #000; overflow: hidden; }
    .spell img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.3s; }
    .spell img[src*="ddragon"] { opacity: 1; } /* Pokazuje tylko gdy link jest poprawny */
    .spell.cooldown img { filter: grayscale(1) brightness(0.3); }
    .timer { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px; text-shadow: 2px 2px #000; pointer-events: none; }
</style>
</head>
<body>
    <div id="status">ŁĄCZENIE...</div>
    <div class="grid" id="view"></div>
<script>
    const roles = ["Top", "Jungle", "Mid", "Adc", "Support"];
    const state = {};
    const view = document.getElementById("view");

    roles.forEach(role => {
        state[role] = [{time: 0, interval: null}, {time: 0, interval: null}];
        const div = document.createElement("div"); div.className = "row";
        div.innerHTML = `<div class="role-name">${role}</div>` + [0,1].map(i => `
            <div class="spell" id="${role}-btn-${i}"><img src="" id="${role}-img-${i}"><div class="timer" id="${role}-timer-${i}"></div></div>`).join("");
        view.appendChild(div);
    });

    const peer = new Peer();
    const targetId = window.location.hash.replace("#", "");

    if (targetId) {
        const conn = peer.connect(targetId);
        conn.on('open', () => {
            document.getElementById("status").innerText = "POŁĄCZONO - POBIERANIE DANYCH...";
            setInterval(() => { if(conn.open) conn.send({type: 'REQ_CONFIG'}); }, 2000); // Co 2 sekundy prosi o stan, jeśli ikonek nie ma
            conn.send({type: 'REQ_CONFIG'}); 
        });
        conn.on('data', (data) => {
            if (data.type === 'INIT') {
                document.getElementById("status").innerText = "STATUS: LIVE";
                Object.keys(data.config).forEach(role => {
                    document.getElementById(`${role}-img-0`).src = data.config[role][0];
                    document.getElementById(`${role}-img-1`).src = data.config[role][1];
                });
            }
            if (data.type === 'TIMER') {
                const slot = state[data.role][data.i];
                const btn = document.getElementById(`${data.role}-btn-${data.i}`);
                const txt = document.getElementById(`${data.role}-timer-${data.i}`);
                if (slot.interval) { clearInterval(slot.interval); slot.interval = null; }
                slot.time = data.time;
                if (slot.time > 0) {
                    btn.classList.add("cooldown");
                    slot.interval = setInterval(() => {
                        slot.time--;
                        if (slot.time <= 0) { clearInterval(slot.interval); txt.innerText = ""; btn.classList.remove("cooldown"); }
                        else { txt.innerText = Math.floor(slot.time/60) + ":" + (slot.time%60).toString().padStart(2,'0'); }
                    }, 1000);
                } else { txt.innerText = ""; btn.classList.remove("cooldown"); }
            }
        });
    }
</script>
</body>
</html>
